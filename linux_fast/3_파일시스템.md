# 파일시스템의 이해

## 파일시스템

스토리지 장치에 파일을 명명, 저장, 읽어내는 방법을 제공하는 시스템

### 파일시스템의 역할

공간관리 : 스토리지 장치에 저장되는 방식을 관리
파일이름관리 : 이름 길이, 특수 문자, 대소문자 구분
디렉토리 관리 : 파일을 포함하는 디렉토리 정보 관리
메타 데이터 관리 : 파일길이, 권한, 디바이스 타입, 수정 시간, 기타 속성들
장애관리 : 시스템 장애 시 파일 유실 방지 (저널링 : 메타데이터나 데이터의 로그를 저장)

- 파일시스템 설계 목적이나 스토리지 장치 및 워크로드에 맞게 다양한 파일 시스템 존재
- XFS : 빠른 복구, 빠른 트랜잭션, 큰 볼륨 지원

## 리눅스의 파일시스템의 분류

<img src="attachment/Pasted image 20221018203243.png">

## 파일 시스템 마운트

리눅스 파일시스템은 /를 시작으로 하위로 내려간다 -> 계층 구조
윈도우는 드라이브, 파티션별로 구성된 네임스페이스 개념

<img src="attachment/Pasted image 20221018203752.png">

## 파일 시스템 마운트와 언마운트

파일 시스템은 여러 파일시스템으로 구성
파일시스템 마운트 명령
`sudo mount /dev/sda1 /usr`

<img src="attachment/Pasted image 20221018203849.png">

마운트 된 모든 파일시스템 확인 -> `mount`

- 시스템에 기본 마운트되는 파일 시스템 정보 -> `/etc/fstab` 에 저장
  -> 재부팅 하면 사라지므로 반드시 추가

<img src="attachment/Pasted image 20221018203942.png">
<img src="attachment/Pasted image 20221018204219.png">
<img src="attachment/Pasted image 20221018204359.png">

### 파일 시스템 언마운트

`unmount`

파일시스템이 사용중인 경우 언마운트가 실패

- 옵션1
- `unmount -f 마운트경로`
- 저널을 사용하는 파일 시스템의 경우 실패

- 옵션2
- 파일 시스템을 사용중인 프로세스 확인
  - `fuser -cv 마운트 위치` or `lsof | grep 마운트 위치`
- 프로세스 종료
  - `kill -15 PID`
  - `kill -9 PID`
- 언마운트 진행
  - `umount 마운트경로`

<img src="attachment/Pasted image 20221018204616.png">

none -> 디바이스 정보(메모리 기반 테스트용)

<img src="attachment/Pasted image 20221018205103.png">

## 디렉토리 구조의 이해

### 파일 시스템 구조 표준

- 리눅스 재단이 유지
- UNIX 파일 시스템의 파일시스템 레이아웃 관례를 정의

<img src="attachment/Pasted image 20221018205203.png">

### 주요 디렉토리

/ : 기본계층 모든 파일시스템의 기본 -> 루트 디렉토리
/bin : 단일 사용자 모드에서 사용가능한 명령어 바이너리 `cat` `ls` `cp`
/sbin : 필수 시스템 바이너리 init, ip, mount
/usr/bin : 대부분의 명령과 실행파일

/opt : 선택 가능한 응용 소프트웨어 패키지
/usr/local : 로컬 소프트웨어, 환경설정 데이터
/etc : 시스템에 필수적인 시작 및 설정파일 (바이너리파일 저장X)
/run : 실행중인 프로그램을 위한 PID, socket을 위한 디렉토리
/var/log : 시스템 로그파일

/home : 사용자 홈 디렉토리
/tmp : 재부팅시 삭제될 수 있는 임시파일

<img src="attachment/Pasted image 20221018205410.png">

## 파일 타입 및 속성의 이해

일반파일, 디렉토리, 문자, 장치파일, 블록장치 파일, 심볼릭 링크, 로컬 도메인 소켓, 네임드 파이프
`file /tmp`

<img src="attachment/Pasted image 20221018205518.png">

`file /dev/tty0`

- 일반파일
  - `cp, mv, touch, editor`
  - 삭제 : `rm`
  - `rm -i` 파일명
    - 의도치 않은 삭제 여부 물어본다
- 디렉토리
  - `mkdir`
  - `rmdir, rm -f`
- 링크
  - 하드 링크 : 원본 파일에 대한 직접적인 참조( 동일한 inode, ls -i )
    - `ln Target Link_name`
    - `rm`
  - 심볼릭 링크 : 원본 파일의 이름을 가리키는 링크
    - `ln -s Target Link_name`
    - `rm`

<img src="attachment/Pasted image 20221018205819.png">

아이노드 정보 확인 `ls -il`

- 파일 타입 - 문자/블록 디바이스 파일 - 시스템의 하드웨어나 주변장치와 통신에 사용 -

<img src="attachment/Pasted image 20221018210346.png">

- 로컬 도메인 소켓(유닉스 도메인 소켓) - 프로세스간 통신을 위해 사용 - 주로 네트워크와 관련 - 생성 : `socket 시스템콜` - 삭제 : `rm/unlink 시스템콜`
  <img src="attachment/Pasted image 20221018210525.png">

<img src="attachment/Pasted image 20221018210723.png">

<img src="attachment/Pasted image 20221018210943.png">

`ls -lht` : 상세, 마지막수정시간기준, 읽기 편하게
<img src="attachment/Pasted image 20221018211145.png">
